#!/bin/bash

function show_help() {
    echo "usage: ./$0 <bot amount> [port]"
    echo "creates <bot amount> penetration bots"
    echo "and sends them to localhost:port (default 8303)"
}

if [ $# -eq 0 ] || [ "$1" == "--help" ]
then
    show_help
    exit
fi

arg_num=$1
arg_port=8303

if [ $# -gt 1 ]
then
    arg_port=$2
fi

re='^[0-9]+$'
if ! [[ $arg_num =~ $re ]]
then
    echo "Error: first argument is not a number '$arg_num'" >&2
    exit 1
fi
if ! [[ $arg_port =~ $re ]]
then
    echo "Error: second argument is not a number '$arg_port'" >&2
    exit 1
fi

echo "starting bots on port: $arg_port"
echo "use ./stop_pentest.sh to stop them"
for (( i=0; i<arg_num; i++ ))
do
    printf "."
    nohup ./build/chillerbot-ng "cl_chiller_inp 0;cl_pentest 1;connect localhost:$arg_port" >/dev/null 2>&1 &
    sleep 0.5
done

echo ""
echo "finished starting $arg_num pentest bots."

